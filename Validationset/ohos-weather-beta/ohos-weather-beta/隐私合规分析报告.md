# 鸿蒙天气应用 - 隐私合规分析报告

**应用名称：** ohos-weather-beta  
**应用包名：** com.ohos.weather  
**分析日期：** 2025年11月4日  
**分析人员：** [你的名字]

---

## 一、应用概述

### 1.1 应用基本信息
- **版本号：** 1.0.0 (versionCode: 1000000)
- **应用类型：** 天气查询工具类应用
- **支持设备：** 手机、平板

### 1.2 核心功能
1. 查询城市天气信息
2. 获取当前位置天气
3. 多城市管理
4. 天气预警信息展示
5. 天气地图展示

---

## 二、功能模块划分

### 模块1：定位服务模块 🌍

**模块描述：** 获取用户地理位置，用于查询当地天气信息

**涉及文件：**
- `libNMC/src/main/ets/api/ApiManager.ets`
- `entry/src/main/ets/constants/AppConstants.ts`

**权限申请：**
| 权限名称 | 权限级别 | 申请时机 | 用途说明 |
|---------|---------|---------|---------|
| ohos.permission.APPROXIMATELY_LOCATION | 粗略位置 | 用户触发"当前位置"功能时 | 获取当前城市名称 |
| ohos.permission.LOCATION | 精确位置 | 用户触发"当前位置"功能时 | 获取精确经纬度坐标 |

**具体实现（代码位置）：**
```
文件：ApiManager.ets
行号：122-138

关键代码：
- 第123行：requestPermissionsFromUser() - 请求位置权限
- 第126行：geoLocationManager.getCurrentLocation() - 获取GPS坐标
- 第127-128行：提取经纬度数据
```

**数据流向：**
```
GPS硬件 → getCurrentLocation() → 经纬度字符串 → qLookupCity() → 
第三方天气API → City对象 → AppStorage本地存储 → UI展示
```

**隐私风险评估：**
- ⚠️ **风险等级：** 中等
- **风险点1：** 位置数据发送至第三方API服务器
- **风险点2：** 未发现位置数据加密传输证据
- **合规性：** ✅ 符合告知同意原则（module.json5有reason字段）

**改进建议：**
1. 位置权限非必须，建议改为可选功能
2. 明确告知用户位置数据将发送给第三方服务
3. 添加HTTPS加密传输验证

---

### 模块2：网络请求模块 🌐

**模块描述：** 与天气数据API服务器通信，获取天气信息

**涉及文件：**
- `libNMC/src/main/ets/api/TaskManager.ets`
- `libNMC/src/main/ets/api/ApiManager.ets`
- `libNMC/src/main/ets/api/ApiEndpoint.ets`

**权限申请：**
| 权限名称 | 权限级别 | 申请时机 | 用途说明 |
|---------|---------|---------|---------|
| ohos.permission.INTERNET | 网络访问 | 应用启动时 | 请求天气数据API |

**网络请求清单：**
| API名称 | 请求类型 | 传输数据 | 返回数据 |
|---------|---------|---------|---------|
| qGetWeatherRealTime | GET/POST | 城市ID/经纬度 | 实时天气数据 |
| qGetWeatherDaily | GET/POST | 城市ID | 未来天气预报 |
| qGetWeatherHourly | GET/POST | 城市ID | 逐小时天气 |
| qLookupCity | GET/POST | 城市名称/经纬度 | 城市信息 |
| qGetWarning | GET/POST | 城市ID | 天气预警 |

**数据流向：**
```
用户输入/位置信息 → ApiManager → HTTP请求 → 
第三方天气API服务器 → JSON响应 → 本地解析 → UI展示
```

**隐私风险评估：**
- ⚠️ **风险等级：** 中等
- **风险点1：** 用户位置信息可能随网络请求发送
- **风险点2：** 需确认第三方API服务商的数据处理政策
- **风险点3：** API密钥存储在本地（PreferenceManager）

**合规性检查：**
- ❓ 未发现隐私政策文档说明第三方数据共享
- ❓ 需确认API通信是否使用HTTPS加密
- ✅ 网络权限为应用核心功能必需

---

### 模块3：本地存储模块 💾

**模块描述：** 本地保存用户设置、缓存天气数据、存储API密钥

**涉及文件：**
- `libNMC/src/main/ets/manager/PreferenceManager.ts`
- `libNMC/src/main/ets/manager/RdbManager.ets`
- `entry/src/main/ets/pages/Index.ets`

**存储内容清单：**
| 存储项 | 存储方式 | 数据类型 | 敏感性 |
|-------|---------|---------|--------|
| API密钥 | Preferences | 字符串 | 高 🔴 |
| API端点 | Preferences | 字符串 | 低 |
| 语言设置 | Preferences | 字符串 | 低 |
| 单位设置（公制/英制） | Preferences | 字符串 | 低 |
| 用户添加的城市列表 | AppStorage/RDB | City[] | 中 🟡 |
| 天气数据缓存 | AppStorage | WeatherData[] | 低 |

**具体实现（代码位置）：**
```
PreferenceManager.ts:
- 第68-70行：setApiKey() - 存储API密钥
- 第78-80行：setLanguage() - 存储语言偏好
- 第83-85行：setUnit() - 存储单位偏好

Index.ets:
- 第38-42行：AppStorage.SetOrCreate() - 创建全局存储
```

**数据安全措施：**
- ❌ 未发现API密钥加密存储
- ❌ 未发现敏感数据访问控制
- ✅ 使用系统提供的Preferences API

**隐私风险评估：**
- ⚠️ **风险等级：** 中等
- **风险点：** API密钥明文存储，可能被其他应用读取（如设备已root）

**改进建议：**
1. 使用加密存储敏感数据（如API密钥）
2. 添加数据访问权限控制
3. 定期清理过期缓存数据

---

### 模块4：界面展示模块 📱

**模块描述：** 展示天气数据，不涉及敏感信息收集

**涉及文件：**
- `entry/src/main/ets/pages/` 下所有页面
- `entry/src/main/ets/components/` 下所有组件

**页面清单：**
1. **Index.ets** - 主页（展示天气）
2. **SettingPage.ets** - 设置页（修改语言、单位）
3. **ApiKeySettingPage.ets** - API设置页（输入API密钥）
4. **EditPage.ets** - 编辑城市页（管理城市列表）
5. **AboutPage.ets** - 关于页（应用信息）
6. **WeatherMapPage.ets** - 天气地图页

**隐私影响：** ✅ 无直接隐私数据收集

---

## 三、权限使用总结

### 3.1 权限清单

| 权限类型 | 权限名称 | 使用场景 | 是否必要 | 合规性 |
|---------|---------|---------|---------|--------|
| 位置 | APPROXIMATELY_LOCATION | 获取当前位置天气 | ❌ 非必要 | ⚠️ 需明确告知第三方共享 |
| 位置 | LOCATION | 获取精确位置天气 | ❌ 非必要 | ⚠️ 需明确告知第三方共享 |
| 网络 | INTERNET | 请求天气数据 | ✅ 必要 | ✅ 符合核心功能 |

### 3.2 权限请求时机分析

```
应用启动
  ↓
EntryAbility.onCreate() - 初始化全局管理器
  ↓
加载Index页面
  ↓
用户点击"当前位置"按钮
  ↓
requestPermissionsFromUser() - 弹出权限请求对话框 ✅ 动态请求
  ↓
用户授权/拒绝
```

**合规性：** ✅ 符合"使用时请求"原则

---

## 四、第三方服务分析

### 4.1 第三方API服务

**服务名称：** [需补充具体API服务商名称]

**传输数据：**
- 城市名称
- 经纬度坐标（如使用定位功能）
- 可能包含的设备信息（需进一步分析HTTP请求头）

**数据用途：** 查询天气数据

**合规性检查：**
- ❓ 未发现隐私政策中披露第三方数据共享
- ❓ 需获取第三方服务商的隐私政策
- ⚠️ 需明确告知用户数据将发送至第三方

---

## 五、隐私合规性评估

### 5.1 合规项 ✅

1. **告知同意原则**
   - ✅ `module.json5`中为位置权限添加了reason说明
   - ✅ 使用动态权限请求（用户触发时才请求）

2. **最小必要原则**
   - ✅ 位置权限仅在需要时请求
   - ✅ 网络权限符合核心功能需求

3. **权限使用规范**
   - ✅ 权限配置在`module.json5`中明确声明
   - ✅ 使用场景（usedScene）设置为"inuse"

### 5.2 不合规/风险项 ⚠️

1. **隐私政策缺失**
   - ❌ 未发现隐私政策文档
   - ❌ 未发现用户协议

2. **第三方数据共享未告知**
   - ❌ 未明确说明位置数据发送给第三方天气API
   - ❌ 未披露第三方服务商信息

3. **数据安全问题**
   - ❌ API密钥明文存储
   - ❌ 未发现数据加密传输证据
   - ❌ 未发现数据删除机制

4. **权限过度申请**
   - ⚠️ 同时申请粗略和精确位置权限（可能只需要粗略位置）

---

## 六、整改建议

### 6.1 高优先级 🔴

1. **添加隐私政策**
   - 在应用首次启动时展示隐私政策
   - 明确说明收集的数据、用途、第三方共享

2. **明确第三方数据共享**
   - 在隐私政策中列出第三方服务商
   - 说明发送给第三方的数据类型

3. **加密存储敏感数据**
   - 使用系统加密API保护API密钥
   - 考虑使用HarmonyOS的HUKS（密钥管理服务）

### 6.2 中优先级 🟡

4. **优化权限申请**
   - 评估是否真的需要精确位置权限
   - 考虑只申请粗略位置权限

5. **添加数据管理功能**
   - 提供清除缓存数据的功能
   - 允许用户删除保存的城市列表

6. **增强数据传输安全**
   - 确保所有API请求使用HTTPS
   - 添加证书校验

### 6.3 低优先级 🟢

7. **完善权限说明**
   - 在首次请求权限时，弹出更详细的说明对话框
   - 解释拒绝权限后的功能影响

8. **添加隐私仪表盘**
   - 在设置页面添加隐私权限管理入口
   - 展示权限使用记录

---

## 七、参考标准

1. 《中华人民共和国个人信息保护法》
2. 《App违法违规收集使用个人信息行为认定方法》
3. 《常见类型移动互联网应用程序必要个人信息范围规定》
4. HarmonyOS应用隐私保护开发指南

---

## 八、附录

### 8.1 权限申请代码位置索引

| 权限 | 文件路径 | 行号 | 代码片段 |
|-----|---------|------|---------|
| APPROXIMATELY_LOCATION | ApiManager.ets | 123 | `requestPermissionsFromUser(...)` |
| LOCATION | module.json5 | 13-18 | 权限声明 |
| INTERNET | module.json5 | 9-11 | 权限声明 |

### 8.2 数据存储位置索引

| 数据类型 | 文件路径 | 行号 | 存储方式 |
|---------|---------|------|---------|
| API密钥 | PreferenceManager.ts | 68-70 | Preferences |
| 城市列表 | Index.ets | 39 | AppStorage |
| 天气缓存 | Index.ets | 38-42 | AppStorage |

---

**报告结论：**

该应用在隐私保护方面存在**中等风险**，主要问题集中在：
1. 缺少隐私政策
2. 未明确告知第三方数据共享
3. 敏感数据（API密钥）未加密存储

建议优先完成**高优先级整改项**，确保符合《个人信息保护法》要求。

---

**审核人：** ___________  
**日期：** 2025年11月4日
