# 隐私合规分析工具清单

## 一、代码分析工具

### 1. 静态代码扫描
```bash
# 搜索敏感API调用
grep -r "requestPermissionsFromUser" ./entry/src
grep -r "geoLocationManager" ./libNMC/src
grep -r "camera" ./entry/src
grep -r "contacts" ./entry/src
grep -r "preferences" ./libNMC/src

# 搜索网络请求
grep -r "http.createHttp" ./libNMC/src
grep -r "request.post" ./libNMC/src
```

### 2. VS Code 扩展推荐
- **HarmonyOS Toolkit** - 鸿蒙开发工具
- **ArkTS Language Service** - 语法高亮
- **Regex Search** - 正则搜索

---

## 二、网络抓包工具

### 1. Charles Proxy
- 用途：抓取HTTP/HTTPS请求
- 检查项：
  - API请求地址
  - 传输的参数（是否包含位置信息）
  - 是否使用HTTPS加密

### 2. Wireshark
- 用途：更底层的网络分析
- 适合：分析加密协议、证书校验

---

## 三、应用分析工具

### 1. 华为DevEco Studio
- 用途：运行和调试鸿蒙应用
- 功能：查看日志、断点调试

### 2. HAP包分析
```bash
# 解压HAP包
unzip app.hap -d ./hap_extracted

# 查看配置文件
cat ./hap_extracted/module.json
```

---

## 四、参考文档

### 官方文档
1. [HarmonyOS隐私保护开发指南](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/privacy-protection-0000001544583881-V3)
2. [权限列表](https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/permissions-0000001544584089-V3)
3. [数据安全开发指南](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/data-security-0000001544583885-V3)

### 法律法规
1. 《个人信息保护法》全文
2. 《App违法违规收集使用个人信息行为认定方法》
3. 《常见类型移动互联网应用程序必要个人信息范围规定》

---

## 五、分析检查清单

### 权限分析
- [ ] 列出所有申请的权限
- [ ] 标注每个权限的使用场景
- [ ] 判断是否符合最小必要原则
- [ ] 检查是否动态申请权限

### 数据流向分析
- [ ] 绘制数据流向图
- [ ] 标注数据采集点
- [ ] 标注数据存储位置
- [ ] 标注数据传输目的地

### 第三方SDK分析
- [ ] 列出所有第三方依赖（oh-package.json5）
- [ ] 查看第三方库的权限需求
- [ ] 检查是否有隐私政策链接

### 存储安全分析
- [ ] 检查是否加密存储敏感数据
- [ ] 检查是否有数据删除机制
- [ ] 检查是否有访问控制

---

## 六、报告模板结构

### 标准隐私报告应包含：
1. **应用概述**
   - 基本信息
   - 核心功能

2. **功能模块划分**
   - 模块1：[名称]
     - 涉及文件
     - 权限申请
     - 数据流向
     - 风险评估
   - 模块2：...

3. **权限使用总结**
   - 权限清单表格
   - 权限申请时机

4. **第三方服务分析**
   - 服务商列表
   - 数据共享情况

5. **合规性评估**
   - 合规项
   - 不合规项
   - 风险等级

6. **整改建议**
   - 高/中/低优先级分类

7. **附录**
   - 代码位置索引
   - 参考标准

---

## 七、真实应用对比分析模板

### 应用对比表
| 对比项 | ohos-weather-beta | 华为天气 | 高德地图 |
|-------|------------------|---------|---------|
| 权限数量 | 3个 | [填写] | [填写] |
| 定位权限使用 | ✅ | [填写] | [填写] |
| 隐私政策 | ❌ | [填写] | [填写] |
| 模块数量 | 4个 | [填写] | [填写] |
| 数据加密 | ❌ | [填写] | [填写] |
| 第三方SDK | 天气API | [填写] | [填写] |

### 优秀实践总结
记录其他应用的优秀做法：
- [ ] 隐私政策展示方式
- [ ] 权限申请引导
- [ ] 数据安全措施
- [ ] 用户控制选项

---

## 八、分析脚本示例

### 自动化权限扫描脚本
```python
# permission_scanner.py
import os
import re

def scan_permissions(root_dir):
    permissions = {}
    
    # 扫描所有.ets和.ts文件
    for root, dirs, files in os.walk(root_dir):
        for file in files:
            if file.endswith(('.ets', '.ts')):
                filepath = os.path.join(root, file)
                with open(filepath, 'r', encoding='utf-8') as f:
                    content = f.read()
                    
                    # 搜索权限请求
                    if 'requestPermissionsFromUser' in content:
                        # 提取权限名称
                        matches = re.findall(r"'ohos\.permission\.\w+'", content)
                        if matches:
                            permissions[filepath] = matches
    
    return permissions

# 使用示例
result = scan_permissions('./entry/src')
for file, perms in result.items():
    print(f"{file}: {perms}")
```

### 数据流向追踪脚本
```python
# data_flow_tracker.py
# 追踪特定数据（如位置信息）的流向

def track_data_flow(keyword, root_dir):
    """
    追踪包含特定关键词的代码位置
    keyword: 如 'latitude', 'longitude', 'location'
    """
    results = []
    
    for root, dirs, files in os.walk(root_dir):
        for file in files:
            if file.endswith(('.ets', '.ts')):
                filepath = os.path.join(root, file)
                with open(filepath, 'r', encoding='utf-8') as f:
                    lines = f.readlines()
                    for i, line in enumerate(lines, 1):
                        if keyword.lower() in line.lower():
                            results.append({
                                'file': filepath,
                                'line': i,
                                'code': line.strip()
                            })
    
    return results
```

---

**使用建议：**
1. 先用工具自动扫描，快速定位关键代码
2. 再人工分析具体的隐私影响
3. 结合抓包验证实际行为
4. 参考其他应用的优秀做法
